<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Toncoin Ultra Pro - Referral Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://app.adsgram.ai/js/adsgram-ad-sdk.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, increment, onSnapshot, arrayUnion } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDXoxAGj6ZDYFq_58H67pOVZRy4x-xJeuY",
            authDomain: "tonminingapp-929f4.firebaseapp.com",
            projectId: "tonminingapp-929f4",
            storageBucket: "tonminingapp-929f4.firebasestorage.app",
            messagingSenderId: "559817357144",
            appId: "1:559817357144:web:b2557413e6441b5e69d72d",
            measurementId: "G-E52VE3RGZZ"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // State Management
        let balance = 0.0, sessionMining = 0.0, friends = 0, isMining = false;
        let adCount = 0, lastAdReset = 0;
        let cfg = { faucetTotal: 0.025, mRate: 0.001, mDur: 60*60, ref: 0.1, ad: 0.01, min: 5.0, faucetCD: 15*60, adCD: 180, maxAds: 3 };
        const tg = window.Telegram.WebApp;
        const user = tg.initDataUnsafe?.user || { id: "6472891", first_name: "Player" };

        const blockId = "YOUR_BLOCK_ID_HERE";
        let AdController = null;
        if (window.Adsgram && blockId !== "YOUR_BLOCK_ID_HERE") {
            AdController = window.Adsgram.init({ blockId: blockId });
        }

        // Settings Sync from Dashboard
        onSnapshot(doc(db, "settings", "global"), (d) => {
            if (d.exists()) {
                cfg = { ...cfg, ...d.data() };
                updateUI();
            }
        });

        // System Broadcast Notifications
        onSnapshot(doc(db, "settings", "broadcast"), (d) => {
            if (d.exists() && d.data().time > Date.now() - 10000) {
                showSuccessPopup("SYSTEM UPDATE", d.data().msg);
            }
        });

        window.spawnCoin = function(sourceId) {
            const source = document.getElementById(sourceId);
            const target = document.getElementById('main-balance');
            if(!source || !target) return;
            const coin = document.createElement('div');
            coin.className = 'floating-coin';
            coin.innerHTML = '<img src="https://cryptologos.cc/logos/toncoin-ton-logo.png" style="width:20px;height:20px;">';
            const rect = source.getBoundingClientRect();
            coin.style.left = (rect.left + rect.width / 2) + 'px';
            coin.style.top = (rect.top + rect.height / 2) + 'px';
            document.body.appendChild(coin);
            const targetRect = target.getBoundingClientRect();
            const destX = targetRect.left + targetRect.width / 2 - rect.left - rect.width / 2;
            const destY = targetRect.top + targetRect.height / 2 - rect.top - rect.height / 2;
            coin.animate([
                { transform: 'translate(0, 0) scale(1) rotate(0deg)', opacity: 1 },
                { transform: `translate(${destX}px, ${destY}px) scale(0.5) rotate(360deg)`, opacity: 0.7 }
            ], { duration: 1000, easing: 'cubic-bezier(0.4, 0, 0.2, 1)' }).onfinish = () => coin.remove();
        };

        async function initDatabase() {
            const userRef = doc(db, "users", String(user.id));
            const snap = await getDoc(userRef);
            if (!snap.exists()) {
                await setDoc(userRef, { name: user.first_name, balance: 0, friends: 0, history: [], partners: [], faucetStart: 0, adStart: 0, miningStart: 0, adCount: 0, lastAdReset: Date.now(), isBanned: false });
                checkReferral();
            } else {
                const data = snap.data();
                
                if (data.isBanned) {
                    document.body.innerHTML = `<div style="background:#020617; color:white; height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center; padding:20px; font-family:sans-serif;">
                        <i class="fa-solid fa-ban" style="color:#ef4444; font-size:60px; margin-bottom:20px;"></i>
                        <h2 style="font-size:24px; font-weight:900; text-transform:uppercase;">Account Suspended</h2>
                        <p style="color:#64748b; margin-top:10px; max-width:300px;">Your account has been banned for violating our terms of service.</p>
                    </div>`;
                    return;
                }

                adCount = data.adCount || 0;
                lastAdReset = data.lastAdReset || Date.now();
                if (Date.now() - lastAdReset > 24 * 60 * 60 * 1000) {
                    adCount = 0;
                    lastAdReset = Date.now();
                    await updateDoc(userRef, { adCount: 0, lastAdReset: lastAdReset });
                }
                if (data.faucetStart) syncFaucet(data.faucetStart);
                if (data.adStart) syncAds(data.adStart);
                if (data.miningStart) syncMining(data.miningStart);
            }
            onSnapshot(userRef, (doc) => {
                if (doc.exists()) {
                    const data = doc.data();
                    balance = data.balance || 0;
                    friends = data.friends || 0;
                    adCount = data.adCount || 0;
                    updateUI();
                    renderHistory(data.history || []);
                    renderPartners(data.partners || []);
                }
            });
        }

        async function checkReferral() {
            const urlParams = new URLSearchParams(window.location.search);
            const rid = urlParams.get('start');
            if (rid && rid.startsWith('r')) {
                const cleanId = rid.replace('r', '');
                if (cleanId !== String(user.id)) {
                    const refRef = doc(db, "users", cleanId);
                    await updateDoc(refRef, { balance: increment(cfg.ref), friends: increment(1), partners: arrayUnion({ id: user.id, name: user.first_name, date: Date.now() }) });
                }
            }
        }

        signInAnonymously(auth).then(() => initDatabase());

        function syncFaucet(startTime) {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            if (elapsed < cfg.faucetCD) startFaucetTimer(cfg.faucetCD - elapsed);
        }

        window.startFaucet = async function() {
            const btn = document.getElementById('f-btn');
            if(btn.disabled) return;
            const now = Date.now();
            await updateDoc(doc(db, "users", String(user.id)), { faucetStart: now });
            startFaucetTimer(cfg.faucetCD);
        };

        function startFaucetTimer(duration) {
            const btn = document.getElementById('f-btn'), timerTxt = document.getElementById('f-timer'), liveAmtTxt = document.getElementById('f-live-amount'), card = document.getElementById('f-card');
            btn.disabled = true; card.classList.remove('pulse-on');
            let sec = duration;
            const inv = setInterval(async () => {
                sec--;
                let progress = ((cfg.faucetCD - sec) / cfg.faucetCD) * cfg.faucetTotal;
                liveAmtTxt.innerText = progress.toFixed(8);
                let m = Math.floor(sec/60), s = sec%60; timerTxt.innerText = `${m}:${s < 10 ? '0'+s : s}`;
                if(sec % 2 === 0) spawnCoin('f-card');
                if (sec <= 0) { 
                    clearInterval(inv); 
                    await updateDoc(doc(db, "users", String(user.id)), { balance: increment(cfg.faucetTotal), faucetStart: 0 });
                    btn.disabled = false; card.classList.add('pulse-on'); timerTxt.innerText = "READY"; liveAmtTxt.innerText = cfg.faucetTotal.toFixed(8);
                    for(let i=0; i<5; i++) setTimeout(() => spawnCoin('f-card'), i*100);
                    showSuccessPopup(`${cfg.faucetTotal} TON`, "Faucet Reward Claimed!");
                }
            }, 1000);
        }

        function syncAds(startTime) {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            if (elapsed < cfg.adCD) startAdTimer(cfg.adCD - elapsed);
        }

        window.runAdsGram = async function() {
            const btn = document.getElementById('ad-btn');
            if(btn.disabled && adCount < cfg.maxAds) return;

            if (adCount >= cfg.maxAds) {
                showSuccessPopup("LIMIT REACHED", "Come back tomorrow!");
                return;
            }

            const giveReward = async () => {
                try {
                    await updateDoc(doc(db, "users", String(user.id)), { balance: increment(cfg.ad), adStart: Date.now(), adCount: increment(1) });
                    for(let i=0; i<8; i++) setTimeout(() => spawnCoin('ad-card'), i*100);
                    showSuccessPopup(`${cfg.ad} TON`, "Bonus Reward Saved!");
                    startAdTimer(cfg.adCD);
                } catch (e) { alert("Error updating reward."); }
            };

            if (AdController) {
                AdController.show().then(() => giveReward()).catch(() => alert("Watch full ad for reward."));
            } else { giveReward(); }
        };

        function startAdTimer(duration) {
            const btn = document.getElementById('ad-btn');
            btn.disabled = true;
            let sec = duration;
            const adTimer = setInterval(async () => {
                sec--;
                let m = Math.floor(sec/60), s = sec%60;
                btn.innerText = `${m}:${s < 10 ? '0'+s : s}`;
                if (sec <= 0) {
                    clearInterval(adTimer);
                    await updateDoc(doc(db, "users", String(user.id)), { adStart: 0 });
                    btn.disabled = false;
                    btn.innerText = "Watch";
                    updateUI();
                }
            }, 1000);
        }

        function syncMining(startTime) {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            // ÿ™ÿπÿØŸäŸÑ: ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ±ÿ®ÿ≠ ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿßŸÑÿ≥ÿßÿπÿ© (cfg.mRate / 3600 ÿ´ÿßŸÜŸäÿ©)
            const ratePerSec = cfg.mRate / 3600;
            if (elapsed < cfg.mDur) { sessionMining = elapsed * ratePerSec; processMining(cfg.mDur - elapsed); }
            else { finishMining(); }
        }

        window.startMining = async function() {
            if(isMining) return;
            const now = Date.now();
            await updateDoc(doc(db, "users", String(user.id)), { miningStart: now });
            sessionMining = 0;
            processMining(cfg.mDur);
        };

        async function finishMining() {
            // ÿßŸÑÿ≠ÿ≥ÿ®ÿ© ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ©: (ÿπÿØÿØ ÿ´ŸàÿßŸÜŸä ÿßŸÑÿ¨ŸÑÿ≥ÿ©) * (ÿßŸÑÿ±ÿ®ÿ≠ ÿßŸÑÿ≥ÿßÿπŸä / 3600)
            const reward = (cfg.mDur / 3600) * cfg.mRate;
            await updateDoc(doc(db, "users", String(user.id)), { balance: increment(reward), miningStart: 0 });
            resetMiningUI();
        }

        function resetMiningUI() {
            const btn = document.getElementById('m-btn'), status = document.getElementById('m-status'), card = document.getElementById('m-card');
            isMining = false; btn.disabled = false; btn.innerText = "Launch Mining";
            card.classList.add('pulse-on'); status.innerText = "IDLE";
            document.getElementById('m-display').innerText = "0.00000000";
        }

        function processMining(duration) {
            if(isMining) return; isMining = true;
            const btn = document.getElementById('m-btn'), status = document.getElementById('m-status'), card = document.getElementById('m-card'), display = document.getElementById('m-display');
            btn.disabled = true; card.classList.remove('pulse-on'); status.innerText = "ONLINE";
            let sec = duration;
            // ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑÿ±ÿ®ÿ≠ ÿßŸÑÿ≥ÿßÿπŸä ÿ•ŸÑŸâ ÿ±ÿ®ÿ≠ ŸÑŸÉŸÑ ÿ´ÿßŸÜŸäÿ© Ÿàÿßÿ≠ÿØÿ©
            const ratePerSec = cfg.mRate / 3600;
            
            const engine = setInterval(async () => {
                sec--; sessionMining += ratePerSec; balance += ratePerSec;
                display.innerText = sessionMining.toFixed(8);
                document.getElementById('main-balance').innerText = balance.toFixed(8);
                let m = Math.floor(sec/60), s = sec%60;
                btn.innerText = `MINING... ${m}:${s < 10 ? '0'+s : s}`;
                if(sec % 3 === 0) spawnCoin('m-card');
                if(sec <= 0) {
                    clearInterval(engine);
                    finishMining();
                    for(let i=0; i<10; i++) setTimeout(() => spawnCoin('m-card'), i*80);
                    showSuccessPopup("Mining Result", "Session Complete!");
                }
            }, 1000);
        }

        window.handleWithdraw = async function() {
            const addr = document.getElementById('w-addr').value, amt = parseFloat(document.getElementById('w-amt').value);
            if(!addr || isNaN(amt) || amt < cfg.min) return alert(`Min ${cfg.min} TON required.`);
            if(amt > balance) return alert("Insufficient funds.");
            document.getElementById('page-wallet').classList.add('shake-view');
            setTimeout(() => { document.getElementById('page-wallet').classList.remove('shake-view'); }, 500);
            await updateDoc(doc(db, "users", String(user.id)), { balance: increment(-amt), history: arrayUnion({ amt: amt, address: addr, status: 'Processing', date: Date.now() }) });
            showSuccessPopup(amt + " TON", "Withdrawal request sent!");
        };

        function updateUI() {
            document.getElementById('main-balance').innerText = balance.toFixed(8);
            document.getElementById('w-total').innerText = balance.toFixed(8);
            document.getElementById('ref-cnt').innerText = friends;
            document.getElementById('ref-earn').innerText = (friends * cfg.ref).toFixed(2);
            document.getElementById('ref-link').innerText = `https://t.me/FreeeeToooon_bot?start=r${user.id}`;
            
            document.getElementById('f-reward-tag').innerText = `+ ${cfg.faucetTotal} TON`;
            
            // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ™ÿßÿ∫ ŸÑŸäÿ∏Ÿáÿ± ÿßŸÑÿ±ÿ®ÿ≠ ÿßŸÑŸÉŸÑŸä ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ŸÖÿØÿ© ÿßŸÑÿ¨ŸÑÿ≥ÿ© (ÿ≥ÿßÿπÿßÿ™) ŸÖÿ∂ÿ±Ÿàÿ®ÿ© ŸÅŸä ÿßŸÑÿ±ÿ®ÿ≠ ÿßŸÑÿ≥ÿßÿπŸä
            const totalMiningReward = (cfg.mDur / 3600) * cfg.mRate;
            document.getElementById('m-reward-tag').innerText = `+ ${totalMiningReward.toFixed(5)} TON`;
            document.getElementById('ad-reward-tag').innerText = `+ ${cfg.ad} TON`;

            const adLimitTxt = document.getElementById('ad-limit-txt');
            const adBtn = document.getElementById('ad-btn');
            const adCard = document.getElementById('ad-card');
            const adIcon = document.getElementById('ad-icon-i');

            if (adCount >= cfg.maxAds) {
                adLimitTxt.innerText = "Come back tomorrow";
                adLimitTxt.className = "text-[9px] font-black text-yellow-300 animate-pulse";
                adBtn.innerText = "DONE";
                adBtn.className = "px-6 py-3 bg-gray-500/50 text-white/50 rounded-xl text-[10px] font-black uppercase cursor-not-allowed";
                adCard.classList.add('ad-finished');
                adIcon.className = "fa-solid fa-calendar-check text-green-400";
            } else {
                adLimitTxt.innerText = `${adCount}/${cfg.maxAds} Today`;
                adLimitTxt.className = "text-[8px] font-bold text-white/70 italic";
                adCard.classList.remove('ad-finished');
            }
        }

        function renderHistory(history) {
            const list = document.getElementById('history-list');
            if(!history || history.length === 0) { list.innerHTML = "<p class='opacity-30 mt-10 text-center'>No payout history yet.</p>"; return; }
            
            list.innerHTML = [...history].reverse().slice(0, 10).map(h => {
                let statusClass = "bg-yellow-500/20 text-yellow-500"; 
                let statusText = h.status || "Processing";
                let icon = "fa-clock-rotate-left";

                if (statusText.toLowerCase() === 'done' || statusText === 'ÿ™ŸÖ ÿßŸÑÿØŸÅÿπ') {
                    statusClass = "bg-green-500/20 text-green-500";
                    icon = "fa-circle-check";
                    statusText = "Completed";
                } else if (statusText.toLowerCase() === 'rejected' || statusText === 'ŸÖÿ±ŸÅŸàÿ∂') {
                    statusClass = "bg-red-500/20 text-red-500";
                    icon = "fa-circle-xmark";
                    statusText = "Rejected";
                } else {
                    statusText = "Processing";
                }

                return `
                <div class="flex justify-between items-center p-4 mb-3 bg-white/5 rounded-2xl border border-white/10">
                    <div class="text-left">
                        <p class="font-black text-white text-sm">${h.amt.toFixed(2)} TON</p>
                        <p class="text-[9px] text-white/40 truncate w-32">${h.address}</p>
                    </div>
                    <div class="text-right">
                        <span class="text-[9px] font-bold px-3 py-1 ${statusClass} rounded-full uppercase tracking-tighter italic">
                             <i class="fa-solid ${icon} mr-1"></i> ${statusText}
                        </span>
                    </div>
                </div>`;
            }).join('');
        }

        function renderPartners(partners) {
            const list = document.getElementById('referral-list');
            if(!partners || partners.length === 0) {
                list.innerHTML = `<div class="text-center py-10 opacity-20"><i class="fa-solid fa-user-group text-4xl mb-2"></i><p class="text-[10px] uppercase font-black">No partners yet</p></div>`;
                return;
            }
            list.innerHTML = [...partners].reverse().map(p => `
                <div class="ref-item-modern">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-violet-500 to-fuchsia-600 flex items-center justify-center text-white border border-white/20 shadow-lg shadow-violet-500/20">
                            <i class="fa-solid fa-user text-xs"></i>
                        </div>
                        <div>
                            <p class="font-black text-[11px] text-white tracking-wide">${p.name || 'Anonymous'}</p>
                            <p class="text-[8px] text-green-400/80 uppercase font-black tracking-tighter flex items-center gap-1">
                                <span class="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"></span> Active Partner
                            </p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-[11px] font-black text-white">+${cfg.ref.toFixed(2)} <span class="text-[8px] text-blue-400">TON</span></p>
                        <p class="text-[7px] text-white/30 font-bold uppercase">${new Date(p.date).toLocaleDateString()}</p>
                    </div>
                </div>`).join('');
        }
        
        tg.expand();
        window.showSuccessPopup = function(amount, message) {
            const popup = document.getElementById('reward-popup');
            document.getElementById('pop-amt').innerText = amount;
            document.getElementById('pop-msg').innerText = message;
            popup.style.display = 'flex';
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#00f2fe', '#f5576c', '#ffffff'] });
        };
        window.closePopup = function() { document.getElementById('reward-popup').style.display = 'none'; };

        window.shareLink = function() {
            const link = document.getElementById('ref-link').innerText;
            const text = "üöÄ Join me on Toncoin Ultra Pro! Start mining TON and earn rewards daily. üíé";
            if (navigator.share) { navigator.share({ title: 'Toncoin Ultra Pro', text: text, url: link }); }
            else { window.open(`https://t.me/share/url?url=${encodeURIComponent(link)}&text=${encodeURIComponent(text)}`); }
        };
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@700;900&family=Orbitron:wght@600&display=swap');
        
        /* ÿ∂ÿ®ÿ∑ ÿßŸÑŸáŸäŸÉŸÑ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä ŸÑŸäŸÉŸàŸÜ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ© */
        body { 
            background: #000428; 
            color: white; 
            font-family: 'Poppins', sans-serif; 
            height: 100vh; 
            overflow: hidden; 
            display: flex; 
            flex-direction: column; 
            margin: 0; 
            padding: 10px; 
            gap: 10px; 
            position: relative; 
            box-sizing: border-box;
        }
        
        #bg-canvas { position: absolute; top: 0; left: 0; z-index: -1; }
        @keyframes glassPulse { 0%, 100% { transform: scale(1); filter: brightness(1); } 50% { transform: scale(1.01); filter: brightness(1.1); } }
        .pulse-on { animation: glassPulse 3s infinite ease-in-out; }
        
        /* ÿ¨ÿπŸÑ ÿßŸÑŸÉÿ±Ÿàÿ™ ÿ™ŸÖÿ™ÿØ ŸÑÿ™ŸÖŸÑÿ£ ÿßŸÑÿ∑ŸàŸÑ ÿßŸÑŸÖÿ™ÿßÿ≠ */
        .glass-card { 
            backdrop-filter: blur(15px); 
            -webkit-backdrop-filter: blur(15px); 
            border-radius: 1.5rem; 
            border: 1px solid rgba(255,255,255,0.15); 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); 
            flex: 1; /* Ÿáÿ∞ÿß ŸáŸà ÿßŸÑÿ≥ÿ± ŸÅŸä ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ© */
            display: flex; 
            flex-direction: column; 
            justify-content: space-evenly; 
            padding: 12px; 
            position: relative; 
            min-height: 0; /* Ÿäÿ≥ŸÖÿ≠ ŸÑŸÑŸÄ flex ÿ®ÿßŸÑÿ™ŸÇŸÑÿµ ÿ•ÿ∞ÿß ŸÑÿ≤ŸÖ ÿßŸÑÿ£ŸÖÿ± */
        }

        .bg-ton-main { background: linear-gradient(135deg, #00b4db, #0083b0); flex: 0.8; }
        .bg-faucet { background: linear-gradient(135deg, #ff00cc, #333399); }
        .bg-mining { background: linear-gradient(135deg, #00f2fe, #4facfe); }
        .bg-ads { background: linear-gradient(135deg, #f093fb, #f5576c); flex: 0.6; }
        
        /* ÿ∂ÿ®ÿ∑ ÿßŸÑÿ≠ÿßŸàŸäÿ© ÿßŸÑÿ≥ŸÅŸÑŸäÿ© */
        .bottom-nav { 
            display: grid; 
            grid-template-cols: 1fr 1fr; 
            gap: 10px; 
            flex: 0.5;
        }

        .ad-finished { filter: saturate(0.2) brightness(0.8); border-color: rgba(255,255,255,0.05); }
        .modal-view { backdrop-filter: blur(50px); background: rgba(0, 4, 25, 0.98); position: fixed; inset: 0; z-index: 100; display: none; flex-direction: column; padding: 20px; }
        .font-cyber { font-family: 'Orbitron', sans-serif; }
        .promo-banner { background: linear-gradient(90deg, #6a11cb 0%, #2575fc 100%); border-radius: 1.5rem; padding: 15px; border: 1px dashed rgba(255,255,255,0.5); }
        
        .ref-stat-card { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 1.5rem; padding: 15px; text-align: center; box-shadow: inset 0 0 15px rgba(139, 92, 246, 0.1); }
        .ref-item-modern { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 1.25rem; padding: 12px 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; transition: all 0.3s ease; }
        
        .reward-popup-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(10px); z-index: 1000; display: none; align-items: center; justify-content: center; }
        .reward-popup-content { background: #1e1e2f; border: 2px solid #00f2fe; border-radius: 2.5rem; padding: 40px; text-align: center; width: 320px; }
        .history-container { overflow-y: auto; flex: 1; }
        .link-box-custom { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 1.5rem; padding: 12px 15px; display: flex; align-items: center; gap: 10px; position: relative; overflow: hidden; }
        .floating-coin { position: fixed; pointer-events: none; z-index: 9999; filter: drop-shadow(0 0 5px gold); }
        .reward-info-tag { font-size: 8px; font-weight: 900; background: rgba(0,0,0,0.3); padding: 2px 8px; border-radius: 50px; color: #fff; text-transform: uppercase; border: 1px solid rgba(255,255,255,0.1); }
        
        /* ÿ™ÿ≠ÿ≥ŸäŸÜ ŸÖÿ∏Ÿáÿ± ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ŸÑŸÖŸÑÿ° ÿßŸÑŸÖÿ≥ÿßÿ≠ÿ© */
        button { border-radius: 1.2rem !important; }
    </style>
</head>
<body>
    <canvas id="bg-canvas"></canvas>

    <div class="glass-card bg-ton-main items-center pulse-on">
        <p class="text-[10px] text-white/80 font-black tracking-widest uppercase">Live TON Assets</p>
        <div class="flex items-center gap-3 bg-black/20 px-6 py-2 rounded-2xl">
            <img src="https://cryptologos.cc/logos/toncoin-ton-logo.png" class="w-8 h-8">
            <span class="text-3xl font-black font-cyber" id="main-balance">0.00000000</span>
        </div>
    </div>

    <div id="f-card" class="glass-card bg-faucet pulse-on">
        <div class="flex justify-between items-center px-2">
            <span class="text-[10px] font-black uppercase"><i class="fa-solid fa-bolt-lightning"></i> Faucet</span>
            <span id="f-reward-tag" class="reward-info-tag">+ 0.025 TON</span>
            <span id="f-timer" class="text-[10px] font-bold bg-black/40 px-3 py-1 rounded-full border border-white/20">READY</span>
        </div>
        <div class="text-center bg-black/10 py-3 rounded-2xl">
            <h2 id="f-live-amount" class="text-2xl font-black font-cyber">0.02500000</h2>
        </div>
        <button onclick="startFaucet()" id="f-btn" class="w-full py-4 bg-white text-indigo-900 rounded-2xl font-black uppercase text-[10px]">Claim Reward</button>
    </div>

    <div id="m-card" class="glass-card bg-mining pulse-on">
        <div class="flex justify-between items-center px-2">
            <span class="text-[10px] font-black uppercase"><i class="fa-solid fa-atom"></i> Mining</span>
            <span id="m-reward-tag" class="reward-info-tag">+ 0.001 TON</span>
            <span id="m-status" class="text-[10px] font-bold bg-black/30 px-3 py-1 rounded-full border border-white/10">IDLE</span>
        </div>
        <div class="text-center bg-black/10 py-3 rounded-2xl">
            <p id="m-display" class="text-2xl font-black font-cyber">0.00000000</p>
        </div>
        <button onclick="startMining()" id="m-btn" class="w-full py-4 bg-blue-900 text-white rounded-2xl font-black uppercase text-[10px] border border-white/20">Launch Mining</button>
    </div>

    <div id="ad-card" class="glass-card bg-ads flex-row items-center justify-between pulse-on">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-white/20 flex items-center justify-center rounded-xl">
                <i id="ad-icon-i" class="fa-solid fa-play"></i>
            </div>
            <div>
                <p class="text-[10px] font-black uppercase">Ad Bonus</p>
                <p class="text-[8px] font-bold text-white/70 italic" id="ad-limit-txt">0/3 Today</p>
            </div>
        </div>
        <button onclick="runAdsGram()" id="ad-btn" class="px-6 py-3 bg-white text-pink-600 rounded-xl text-[10px] font-black uppercase">Watch</button>
    </div>

    <div class="bottom-nav">
        <button onclick="openPage('wallet')" class="glass-card bg-emerald-500 items-center justify-center flex-row gap-2">
            <i class="fa-solid fa-wallet"></i><span class="text-[10px] font-black uppercase">Withdraw</span>
        </button>
        <button onclick="openPage('referral')" class="glass-card bg-violet-600 items-center justify-center flex-row gap-2">
            <i class="fa-solid fa-users"></i><span class="text-[10px] font-black uppercase">Partners</span>
        </button>
    </div>

    <div id="page-wallet" class="modal-view">
        <div class="flex items-center justify-between mb-8">
            <h2 class="text-emerald-400 font-black text-xl italic uppercase">Finance</h2>
            <button onclick="closePage()" class="w-10 h-10 glass-card bg-white/10 flex items-center justify-center"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div class="glass-card bg-emerald-600/20 p-8 text-center mb-6 border-emerald-500/40 shrink-0">
            <p id="w-total" class="text-3xl font-black font-cyber text-emerald-400">0.00000000</p>
            <p class="text-[9px] uppercase text-white/50 mt-2 tracking-widest">Total balance TON</p>
        </div>
        <div class="space-y-4 mb-8 shrink-0">
            <input type="text" id="w-addr" placeholder="TON Wallet Address" class="w-full glass-card bg-white/5 p-4 text-xs border-white/10 outline-none text-white">
            <input type="number" id="w-amt" placeholder="Minimum withdrawal: 5.0" class="w-full glass-card bg-white/5 p-4 text-xs border-white/10 outline-none text-white">
            <button onclick="handleWithdraw()" class="w-full py-4 bg-emerald-500 text-white font-black uppercase text-xs rounded-2xl">Confirm Payout</button>
        </div>
        <div id="history-list" class="history-container pb-10"></div>
    </div>

    <div id="page-referral" class="modal-view">
        <div class="flex items-center justify-between mb-4">
            <h2 class="text-violet-400 font-black text-xl italic uppercase tracking-tighter">Affiliate System</h2>
            <button onclick="closePage()" class="w-10 h-10 rounded-2xl bg-white/5 flex items-center justify-center border border-white/10 shadow-lg"><i class="fa-solid fa-xmark text-white/50"></i></button>
        </div>
        <div class="promo-banner mb-5 flex items-center justify-between animate-pulse">
            <div>
                <p class="text-[9px] font-black uppercase text-white/60 mb-1">Instant Reward</p>
                <p class="text-lg font-black text-white">Get <span class="text-yellow-400">0.10 TON</span></p>
            </div>
            <i class="fa-solid fa-gift text-2xl text-yellow-400"></i>
        </div>
        <div class="link-box-custom mb-6 shrink-0 group" onclick="copyRef()">
            <div class="flex-1 overflow-hidden">
                <p class="text-[8px] uppercase font-black text-violet-400 mb-1">Unique Invitation Link</p>
                <div id="ref-link" class="text-[10px] font-mono text-white/70 truncate italic">...loading link...</div>
            </div>
            <i class="fa-solid fa-copy text-violet-400"></i>
        </div>
        <button onclick="shareLink()" class="w-full bg-violet-600 py-4 rounded-2xl text-[10px] font-black uppercase flex items-center justify-center gap-3 mb-6">
            <i class="fa-solid fa-share-nodes"></i> Send Invite To Friends
        </button>
        <div class="grid grid-cols-2 gap-4 mb-6 text-center">
            <div class="ref-stat-card">
                <p class="text-[8px] text-white/40 uppercase font-black">Team</p>
                <p id="ref-cnt" class="text-2xl font-black font-cyber">0</p>
            </div>
            <div class="ref-stat-card">
                <p class="text-[8px] text-white/40 uppercase font-black">Profits</p>
                <p id="ref-earn" class="text-2xl font-black font-cyber text-blue-400">0.00</p>
            </div>
        </div>
        <div id="referral-list" class="history-container pb-5 px-1"></div>
    </div>

    <div id="reward-popup" class="reward-popup-overlay">
        <div class="reward-popup-content">
            <i class="fa-solid fa-trophy text-yellow-400 text-5xl mb-4"></i>
            <h2 class="text-2xl font-black font-cyber text-white mb-2">NOTICE</h2>
            <p id="pop-msg" class="text-white/60 text-[10px] uppercase mb-4">Success</p>
            <div class="bg-white/10 rounded-2xl py-4 mb-6"><p id="pop-amt" class="text-3xl font-black text-cyan-400 font-cyber">0.00</p></div>
            <button onclick="closePopup()" class="w-full py-4 bg-cyan-500 text-white font-black rounded-2xl uppercase">Close</button>
        </div>
    </div>

    <script>
        // ÿ•ÿπÿØÿßÿØ ÿÆŸÑŸÅŸäÿ© ÿßŸÑŸÜÿ¨ŸàŸÖ ÿßŸÑŸÖÿ™ÿ≠ÿ±ŸÉÿ©
        const canvas = document.getElementById('bg-canvas'), ctx = canvas.getContext('2d');
        let particles = [];
        function initCanvas() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; particles = []; for(let i=0; i<60; i++) particles.push({ x: Math.random()*canvas.width, y: Math.random()*canvas.height, size: Math.random()*1.5, speed: Math.random()*0.3+0.1, opacity: Math.random() }); }
        function drawBackground() { ctx.clearRect(0, 0, canvas.width, canvas.height); ctx.fillStyle = "white"; particles.forEach(p => { ctx.globalAlpha = p.opacity; ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI*2); ctx.fill(); p.y -= p.speed; if(p.y < 0) p.y = canvas.height; }); requestAnimationFrame(drawBackground); }
        window.addEventListener('resize', initCanvas); initCanvas(); drawBackground();
        
        window.copyRef = function() { const link = document.getElementById('ref-link').innerText; navigator.clipboard.writeText(link); document.getElementById('ref-link').innerText = "COPIED!"; setTimeout(() => { document.getElementById('ref-link').innerText = link; }, 1500); tg.HapticFeedback.notificationOccurred('success'); };
        window.openPage = function(p) { document.getElementById('page-'+p).style.display = 'flex'; };
        window.closePage = function() { document.querySelectorAll('.modal-view').forEach(v => v.style.display='none'); };
    </script>
</body>
</html>
